-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\hdlsrc\combinedTxRx_ExternalMode\CombinedT_ip_src_Phase_Shift_FP.vhd
-- Created: 2018-02-01 13:20:09
-- 
-- Generated by MATLAB 9.3 and HDL Coder 3.11
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: CombinedT_ip_src_Phase_Shift_FP
-- Source Path: combinedTxRx_ExternalMode/Combined TX and RX/Receiver HDL/Frame Recover/Frequency Recovery/Phase 
-- Shift F
-- Hierarchy Level: 4
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY CombinedT_ip_src_Phase_Shift_FP IS
  PORT( In1_re                            :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En10
        In1_im                            :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En10
        Phi                               :   IN    std_logic_vector(24 DOWNTO 0);  -- sfix25_En20
        Out1_re                           :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En13
        Out1_im                           :   OUT   std_logic_vector(15 DOWNTO 0)  -- sfix16_En13
        );
END CombinedT_ip_src_Phase_Shift_FP;


ARCHITECTURE rtl OF CombinedT_ip_src_Phase_Shift_FP IS

  -- Component Declarations
  COMPONENT CombinedT_ip_src_Cosine_HDL_Optimized
    PORT( u                               :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En12
          x_re                            :   OUT   std_logic_vector(31 DOWNTO 0);  -- sfix32_En20
          x_im                            :   OUT   std_logic_vector(31 DOWNTO 0)  -- sfix32_En20
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : CombinedT_ip_src_Cosine_HDL_Optimized
    USE ENTITY work.CombinedT_ip_src_Cosine_HDL_Optimized(rtl);

  -- Signals
  SIGNAL In1_re_signed                    : signed(15 DOWNTO 0);  -- sfix16_En10
  SIGNAL In1_im_signed                    : signed(15 DOWNTO 0);  -- sfix16_En10
  SIGNAL Phi_signed                       : signed(24 DOWNTO 0);  -- sfix25_En20
  SIGNAL Gain_mul_temp                    : signed(49 DOWNTO 0);  -- sfix50_En40
  SIGNAL Gain_out1                        : signed(15 DOWNTO 0);  -- sfix16_En12
  SIGNAL Cosine_HDL_Optimized_out1_re     : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Cosine_HDL_Optimized_out1_im     : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Cosine_HDL_Optimized_out1_re_signed : signed(31 DOWNTO 0);  -- sfix32_En20
  SIGNAL Cosine_HDL_Optimized_out1_im_signed : signed(31 DOWNTO 0);  -- sfix32_En20
  SIGNAL Product_mul_temp                 : signed(47 DOWNTO 0);  -- sfix48_En30
  SIGNAL Product_sub_cast                 : signed(15 DOWNTO 0);  -- sfix16_En13
  SIGNAL Product_sub_cast_1               : signed(16 DOWNTO 0);  -- sfix17_En13
  SIGNAL Product_mul_temp_1               : signed(47 DOWNTO 0);  -- sfix48_En30
  SIGNAL Product_sub_cast_2               : signed(15 DOWNTO 0);  -- sfix16_En13
  SIGNAL Product_sub_cast_3               : signed(16 DOWNTO 0);  -- sfix17_En13
  SIGNAL Product_sub_temp                 : signed(16 DOWNTO 0);  -- sfix17_En13
  SIGNAL Product_mul_temp_2               : signed(47 DOWNTO 0);  -- sfix48_En30
  SIGNAL Product_add_cast                 : signed(15 DOWNTO 0);  -- sfix16_En13
  SIGNAL Product_add_cast_1               : signed(16 DOWNTO 0);  -- sfix17_En13
  SIGNAL Product_mul_temp_3               : signed(47 DOWNTO 0);  -- sfix48_En30
  SIGNAL Product_add_cast_2               : signed(15 DOWNTO 0);  -- sfix16_En13
  SIGNAL Product_add_cast_3               : signed(16 DOWNTO 0);  -- sfix17_En13
  SIGNAL Product_add_temp                 : signed(16 DOWNTO 0);  -- sfix17_En13
  SIGNAL Product_out1_re                  : signed(15 DOWNTO 0);  -- sfix16_En13
  SIGNAL Product_out1_im                  : signed(15 DOWNTO 0);  -- sfix16_En13

BEGIN
  -- Sign Comes from original
  -- loop filter design

  u_Cosine_HDL_Optimized : CombinedT_ip_src_Cosine_HDL_Optimized
    PORT MAP( u => std_logic_vector(Gain_out1),  -- sfix16_En12
              x_re => Cosine_HDL_Optimized_out1_re,  -- sfix32_En20
              x_im => Cosine_HDL_Optimized_out1_im  -- sfix32_En20
              );

  In1_re_signed <= signed(In1_re);

  In1_im_signed <= signed(In1_im);

  Phi_signed <= signed(Phi);

  Gain_mul_temp <= to_signed(-16#0028BE6#, 25) * Phi_signed;
  
  Gain_out1 <= X"7FFF" WHEN (Gain_mul_temp(49) = '0') AND (Gain_mul_temp(48 DOWNTO 43) /= "000000") ELSE
      X"8000" WHEN (Gain_mul_temp(49) = '1') AND (Gain_mul_temp(48 DOWNTO 43) /= "111111") ELSE
      Gain_mul_temp(43 DOWNTO 28);

  Cosine_HDL_Optimized_out1_re_signed <= signed(Cosine_HDL_Optimized_out1_re);

  Cosine_HDL_Optimized_out1_im_signed <= signed(Cosine_HDL_Optimized_out1_im);

  Product_mul_temp <= In1_re_signed * Cosine_HDL_Optimized_out1_re_signed;
  
  Product_sub_cast <= X"7FFF" WHEN (Product_mul_temp(47) = '0') AND (Product_mul_temp(46 DOWNTO 32) /= "000000000000000") ELSE
      X"8000" WHEN (Product_mul_temp(47) = '1') AND (Product_mul_temp(46 DOWNTO 32) /= "111111111111111") ELSE
      Product_mul_temp(32 DOWNTO 17);
  Product_sub_cast_1 <= resize(Product_sub_cast, 17);
  Product_mul_temp_1 <= In1_im_signed * Cosine_HDL_Optimized_out1_im_signed;
  
  Product_sub_cast_2 <= X"7FFF" WHEN (Product_mul_temp_1(47) = '0') AND (Product_mul_temp_1(46 DOWNTO 32) /= "000000000000000") ELSE
      X"8000" WHEN (Product_mul_temp_1(47) = '1') AND (Product_mul_temp_1(46 DOWNTO 32) /= "111111111111111") ELSE
      Product_mul_temp_1(32 DOWNTO 17);
  Product_sub_cast_3 <= resize(Product_sub_cast_2, 17);
  Product_sub_temp <= Product_sub_cast_1 - Product_sub_cast_3;
  
  Product_out1_re <= X"7FFF" WHEN (Product_sub_temp(16) = '0') AND (Product_sub_temp(15) /= '0') ELSE
      X"8000" WHEN (Product_sub_temp(16) = '1') AND (Product_sub_temp(15) /= '1') ELSE
      Product_sub_temp(15 DOWNTO 0);
  Product_mul_temp_2 <= In1_im_signed * Cosine_HDL_Optimized_out1_re_signed;
  
  Product_add_cast <= X"7FFF" WHEN (Product_mul_temp_2(47) = '0') AND (Product_mul_temp_2(46 DOWNTO 32) /= "000000000000000") ELSE
      X"8000" WHEN (Product_mul_temp_2(47) = '1') AND (Product_mul_temp_2(46 DOWNTO 32) /= "111111111111111") ELSE
      Product_mul_temp_2(32 DOWNTO 17);
  Product_add_cast_1 <= resize(Product_add_cast, 17);
  Product_mul_temp_3 <= In1_re_signed * Cosine_HDL_Optimized_out1_im_signed;
  
  Product_add_cast_2 <= X"7FFF" WHEN (Product_mul_temp_3(47) = '0') AND (Product_mul_temp_3(46 DOWNTO 32) /= "000000000000000") ELSE
      X"8000" WHEN (Product_mul_temp_3(47) = '1') AND (Product_mul_temp_3(46 DOWNTO 32) /= "111111111111111") ELSE
      Product_mul_temp_3(32 DOWNTO 17);
  Product_add_cast_3 <= resize(Product_add_cast_2, 17);
  Product_add_temp <= Product_add_cast_1 + Product_add_cast_3;
  
  Product_out1_im <= X"7FFF" WHEN (Product_add_temp(16) = '0') AND (Product_add_temp(15) /= '0') ELSE
      X"8000" WHEN (Product_add_temp(16) = '1') AND (Product_add_temp(15) /= '1') ELSE
      Product_add_temp(15 DOWNTO 0);

  Out1_re <= std_logic_vector(Product_out1_re);

  Out1_im <= std_logic_vector(Product_out1_im);

END rtl;

